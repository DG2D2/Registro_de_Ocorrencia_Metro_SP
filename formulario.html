<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="assets/icons8-metro-50.png" type="image/x-icon"/>
  <title>Registro de Ocorrência - Metrô SP</title>
  <link rel="stylesheet" href="formulario.css" />
</head>
<body>
  
  <form id="form-ocorrencia">
    <h2>Ocorrência de Delito no Metrô</h2>

    <label>Tipo de Ocorrência:<br>
      <span class="form-description">
        Selecione o tipo de delito ocorrido
      </span>
      <select name="tipo_ocorrencia" required>
        <option value="">Selecione</option>
        <option value="Furto (Art. 155 do Código Penal)">Furto (Art. 155 do Código Penal)</option>
        <option value="Assédio Sexual (Art. 216-A do Código Penal)">Assédio Sexual (Art. 216-A do Código Penal)</option>
        <option value="Lesão Corporal (Art. 129 do Código Penal)">Lesão Corporal (Art. 129 do Código Penal)</option>
        <option value="Conduta Indecente ou Atos Obscenos (Art. 233 do Código Penal)">Conduta Indecente ou Atos Obscenos (Art. 233 do Código Penal)</option>
        <option value="Calúnia (Art. 138 do Código Penal)">Calúnia (Art. 138 do Código Penal)</option>
        <option value="Injúria (Art. 140 do Código Penal)">Injúria (Art. 140 do Código Penal)</option>
        <option value="Constrangimento Ilegal (Art. 146 do Código Penal)">Constrangimento Ilegal (Art. 146 do Código Penal)</option>
        <option value="Ameaça (Art. 147 do Código Penal)">Ameaça (Art. 147 do Código Penal)</option>
        <option value="Perseguição (Art. 147-A do Código Penal)">Perseguição (Art. 147-A do Código Penal)</option>
        <option value="Outra">Outra</option>
      </select>
    </label><br><br>

    <label>Linha do Metrô:<br>
      <span class="form-description">
        Escolha a linha onde o incidente ocorreu
      </span>
      <select name="linha_metro" id="linha_metro" required>
        <option value="">Selecione</option>
        <option value="Azul">Azul</option>
        <option value="Verde">Verde</option>
        <option value="Vermelha">Vermelha</option>
        <option value="Amarela">Amarela</option>
      </select>
    </label><br><br>

    <label>Estação:<br>
      <span class="form-description">
        Escolha a estação onde o incidente ocorreu
      </span>
      <select name="estacao" id="estacao" required>
        <option value="">Selecione</option>
      </select>
    </label><br><br>

    <label>Gênero da Vítima:<br>
      <span class="form-description">
        Informe o gênero de quem sofreu a ação
      </span>
      <select name="genero" required>
        <option value="">Selecione</option>
        <option value="Masculino">Masculino</option>
        <option value="Feminino">Feminino</option>
        <option value="Outro">Outro</option>
        <option value="Não Especificado">Não Especificado</option>
      </select>
    </label><br><br>

    <label>Idade da Vítima:
      <input type="number" name="idade" min="5" max="120" required />
    </label><br><br>

    <label>Data do Ocorrido:
      <input type="date" name="data_ocorrido" required />
    </label><br><br>
 
    <label>Hora do Ocorrido:
      <input type="time" name="hora_ocorrido" required />
    </label><br><br>

    <label>Descrição do ocorrido:
      <textarea name="descricao" rows="4" cols="40" placeholder="Descreva brevemente (opcional)"></textarea>
    </label><br><br>

    <label>
      <input type="checkbox" name="consentimento" required />
      Declaro que li e concordo com a <span class="link-politica grifado" onclick="mostrarOcultarPolitica()">Política de Privacidade</span> e a LGPD.
    </label><br><br>

    <!-- Política de Privacidade (inicialmente escondida) -->
    <div id="politica" style="display: none; margin-bottom: 20px; padding: 20px; border: 1px solid #ccc; background-color: #f9f9f9; border-radius: 10px; line-height: 1.6;">
      <h3 style="text-align: center;">Política de Privacidade – Coleta e análise de dados para fins acadêmicos</h3>
      <p><strong>Última atualização:</strong> 04/10/2025 20:14:50</p>

      <p>Esta Política de Privacidade tem como objetivo informar de forma clara e transparente como os seus dados pessoais serão coletados, utilizados, armazenados e protegidos ao preencher o formulário, desenvolvido para fins acadêmicos como: estudo e análise de incidentes no Metrô de São Paulo.</p>

      <h4>1. Quem somos</h4>
      <p>Somos um grupo de estudantes da matéria de <strong>Banco de Dados Avançados</strong> na <strong>Universidade Cidade de São Paulo (UNICID)</strong>, e também os controladores responsáveis pelo tratamento dos dados coletados por meio deste formulário.</p>

      <h4>2. Quais dados coletamos</h4>
      <p>Ao preencher o formulário, poderemos coletar os seguintes dados pessoais:</p>
      <ul>
        <li>Data de nascimento</li>
        <li>Gênero</li>
      </ul>

      <h4>3. Finalidade da coleta de dados</h4>
      <p>Os dados coletados têm como objetivo:</p>
      <ul>
        <li>Realizar análise estatística e qualitativa sobre a experiência dos passageiros do Metrô de São Paulo</li>
        <li>Compreender o perfil dos usuários</li>
        <li>Subsidiar estudos acadêmicos, institucionais ou internos, conforme descrito neste projeto</li>
      </ul>
      <p>Não coletamos dados sensíveis ou excessivos, e não há finalidade comercial ou publicitária.</p>

      <h4>4. Base legal para o tratamento de dados</h4>
      <p>O tratamento dos dados se baseia nos seguintes fundamentos legais previstos na LGPD:</p>
      <ul>
        <li><strong>Consentimento do titular (Art. 7º, I)</strong> – o titular dos dados autoriza expressamente o uso das informações para os fins informados nesta Política.</li>
        <li><strong>Realização de estudos por órgão de pesquisa</strong>, garantida, sempre que possível, a anonimização dos dados pessoais (Art. 7º, IV, e Art. 13).</li>
      </ul>

      <h4>5. Compartilhamento dos dados</h4>
      <p>Os dados coletados não serão compartilhados com terceiros, exceto:</p>
      <ul>
        <li>Quando exigido por lei ou ordem judicial</li>
        <li>Quando necessário para fins de auditoria acadêmica ou científica, com devida anonimização</li>
      </ul>

      <h4>6. Armazenamento e segurança dos dados</h4>
      <p>Seus dados serão armazenados de forma segura, utilizando banco de dados com a devida segurança projetada, com acesso restrito às pessoas autorizadas envolvidas no projeto.</p>
      <p>Os dados serão mantidos pelo período necessário para atingir os objetivos da pesquisa, e poderão ser excluídos ou anonimizados após esse prazo.</p>

      <h4>7. Direitos do titular dos dados</h4>
      <p>Nos termos da LGPD, você tem o direito de:</p>
      <ul>
        <li>Confirmar a existência de tratamento</li>
        <li>Acessar seus dados</li>
        <li>Corrigir dados incompletos, inexatos ou desatualizados</li>
        <li>Revogar o consentimento a qualquer momento</li>
        <li>Solicitar a exclusão dos dados (quando aplicável)</li>
      </ul>
      <p>Para exercer qualquer um desses direitos, entre em contato com o responsável através do e-mail: <a href="mailto:contatoproj.bdavancado@gmail.com">contatoproj.bdavancado@gmail.com</a>.</p>

      <h4>8. Consentimento</h4>
      <p>Ao preencher este formulário, você declara estar ciente desta Política de Privacidade e concorda com o tratamento dos seus dados pessoais conforme as finalidades descritas.</p>

      <h4>9. Alterações nesta Política</h4>
      <p>Esta Política de Privacidade poderá ser atualizada a qualquer momento, visando adequações legais ou operacionais. Em caso de alterações significativas, você será informado.</p>

      <h4>Dúvidas?</h4>
      <p>Se tiver qualquer dúvida sobre o uso dos seus dados, entre em contato conosco:</p>
      <p><strong>E-mail:</strong> <a href="mailto:contatoproj.bdavancado@gmail.com">contatoproj.bdavancado@gmail.com</a></p>
    </div>


    <button type="submit">Enviar Ocorrência</button>
    <button type="button" onclick="irParaApresentacao()">Voltar</button>
  </form>

  <div id="mensagem" style="display: none;"></div>

  <script>
    // Voltar para a página inicial
    function irParaApresentacao() {
      window.location.href = "apresentacao.html";
    }

    // Mostrar / esconder política de privacidade
    function mostrarOcultarPolitica() {
      const politica = document.getElementById("politica");
      politica.style.display = politica.style.display === "none" ? "block" : "none";
    }

    // Lista de estações por linha
    const estacoesPorLinha = {
      Vermelha: ["Palmeiras–Barra Funda","Marechal Deodoro","Santa Cecília","República","Anhangabaú","Sé","Pedro II","Brás","Bresser–Mooca","Belém","Tatuapé","Carrão","Penha","Vila Matilde","Guilhermina–Esperança","Patriarca–Vila Ré","Artur Alvim","Corinthians–Itaquera"],
      Azul: ["Tucuruvi","Parada Inglesa","Jardim São Paulo – Ayrton Senna","Santana","Carandiru","Portuguesa–Tietê","Armênia","Tiradentes","Luz","São Bento","Sé","Liberdade","São Joaquim","Vergueiro","Paraíso","Ana Rosa","Vila Mariana","Santa Cruz","Praça da Árvore","Saúde","São Judas","Conceição","Jabaquara"],
      Verde: ["Vila Prudente","Tamanduateí","Sacomã","Alto do Ipiranga","Santos–Imigrantes","Chácara Klabin","Ana Rosa","Paraíso","Brigadeiro","Trianon–Masp","Consolação","Clínicas","Sumáré","Vila Madalena"],
      Amarela: ["Luz","República","Higienópolis–Mackenzie","Paulista","Pinheiros","Faria Lima","Fradique Coutinho","Oscar Freire","São Paulo–Morumbi","Vila Sônia"]
    };

    // Atualiza a lista de estações conforme a linha selecionada
    document.getElementById("linha_metro").addEventListener("change", function() {
      const linha = this.value;
      const estacaoSelect = document.getElementById("estacao");
      estacaoSelect.innerHTML = "<option value=''>Selecione</option>";
      if (estacoesPorLinha[linha]) {
        estacoesPorLinha[linha].forEach(est => {
          const opt = document.createElement("option");
          opt.value = est;
          opt.textContent = est;
          estacaoSelect.appendChild(opt);
        });
      }
    });

    // Envio do formulário via Fetch API
    const form = document.getElementById("form-ocorrencia");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      data.consentimento = formData.get("consentimento") ? true : false;

      // Detecta automaticamente o ambiente (local ou Railway)
      const backendURL =
        window.location.hostname === "localhost"
          ? "http://localhost:3000/enviar"
          : "https://registrodeocorrenciametrosp-production.up.railway.app/enviar";

      try {
        const response = await fetch(backendURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const message = await response.text();
        alert(message);
        form.reset();
      } catch (error) {
        alert("Erro ao enviar ocorrência. Tente novamente.");
        console.error(error);
      }
    });
  </script>
</body>
</html>
